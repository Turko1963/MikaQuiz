<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רמת הידע שלי בשוק ההון</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- שאר ה-CSS נשאר אותו דבר... -->
</head>
<body>
    <!-- שאר ה-HTML נשאר אותו דבר... -->

    <script>
        const allQuestions = [
            // ... כל השאלות נשארות אותו דבר ...
        ];

        let currentQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let selectedAnswer = null;
        let timer;
        let timeLeft;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startQuiz() {
            document.querySelector('.start-screen').style.display = 'none';
            document.querySelector('.quiz-container').classList.add('active');
            document.querySelector('.result-screen').style.display = 'none';
            currentQuestions = shuffleArray([...allQuestions]);
            currentQuestion = 0;
            score = 0;
            showQuestion();
        }

        function startTimer() {
            timeLeft = 30;
            updateTimer();
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    nextQuestion();
                }
            }, 1000);
        }

        function updateTimer() {
            const timerElement = document.querySelector('.timer');
            timerElement.textContent = `${timeLeft} שניות`;
            if (timeLeft <= 5) {
                timerElement.classList.add('warning');
            } else {
                timerElement.classList.remove('warning');
            }
        }

        function showQuestion() {
            clearInterval(timer);
            startTimer();
            
            selectedAnswer = null;
            const question = currentQuestions[currentQuestion];
            document.querySelector('.question').textContent = question.question;
            document.querySelector('.question-number').textContent = `שאלה ${currentQuestion + 1} מתוך 10`;
            
            const optionsContainer = document.querySelector('.options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('div');
                button.className = 'option';
                button.textContent = option;
                button.onclick = () => selectOption(index);
                optionsContainer.appendChild(button);
            });

            updateProgress();
        }

        function selectOption(index) {
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            selectedAnswer = index;
        }

        function nextQuestion() {
            clearInterval(timer);

            if (selectedAnswer !== null && selectedAnswer === currentQuestions[currentQuestion].correct) {
                score++;
            }

            currentQuestion++;

            if (currentQuestion >= 10) {
                showResults();
            } else {
                showQuestion();
            }
        }

        function updateProgress() {
            const progress = (currentQuestion / 10) * 100;
            document.querySelector('.progress-bar').style.width = `${progress}%`;
        }

        function getEmoji(percentage) {
            if (percentage >= 90) return '🏆';
            if (percentage >= 80) return '🌟';
            if (percentage >= 70) return '😊';
            if (percentage >= 50) return '🤔';
            return '😢';
        }

        function showResults() {
            document.querySelector('.quiz-container').classList.remove('active');
            document.querySelector('.result-screen').style.display = 'block';
            
            const percentage = (score / 10) * 100;
            document.querySelector('.score').textContent = `${percentage}%`;
            document.querySelector('.emoji').textContent = getEmoji(percentage);
            
            let message;
            if (percentage >= 90) message = "מצוין! יש לך ידע מעמיק בשוק ההון";
            else if (percentage >= 80) message = "כל הכבוד! יש לך הבנה טובה מאוד בשוק ההון";
            else if (percentage >= 70) message = "טוב! יש לך ידע בסיסי טוב בשוק ההון";
            else if (percentage >= 50) message = "לא רע, אבל יש מקום לשיפור";
            else message = "כדאי ללמוד עוד על שוק ההון";
            
            document.querySelector('.message').textContent = message;
        }

        function restartQuiz() {
            document.querySelector('.start-screen').style.display = 'none';
            document.querySelector('.result-screen').style.display = 'none';
            currentQuestions = [];
            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;
            startQuiz();
        }

        // מגדיר את הפונקציות כגלובליות כשהדף נטען
        window.onload = function() {
            window.startQuiz = startQuiz;
            window.nextQuestion = nextQuestion;
            window.restartQuiz = restartQuiz;
            window.selectOption = selectOption;
        }
    </script>
</body>
</html>
